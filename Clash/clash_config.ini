port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: 127.0.0.1:9090

proxies: {{ getProxies | rename:replace:' ○$':'' | clash }}

proxy-groups:
  - name: 香港
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(香港|HK|Hong Kong).*" | clash | proxyNames }}
    
  - name: 台湾
    type: url-test  # 自动选择延迟最低的节点
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
    {{ getProxies | regexFilter:".*(台湾|台北|台中|TW|Taiwan|Taipei).*" | clash | proxyNames }}

  - name: 日本
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(日本|JP|Japan).*" | clash | proxyNames }}

  - name: 新加坡
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(新加坡|狮城|SG|Singapore).*" | clash | proxyNames }}

  - name: 美国
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(美国|USA|US|United States).*" | clash | proxyNames }}

  - name: 英国
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(英国|UK|United Kingdom).*" | clash | proxyNames }}

  - name: 韩国
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(韩国|KR|Korea).*" | clash | proxyNames }}

  - name: 德国
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies: {{ getProxies | regexFilter:".*(德国|DE|Germany).*" | clash | proxyNames }}

  - name: 其他
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - {{ getProxies 
         | discardRegex:".*(香港|台湾|台北|台中|日本|新加坡|狮城|美国|英国|韩国|德国|HK|TW|JP|SG|US|UK|KR|DE).*" 
         | clash 
         | proxyNames }}
    
 - name: 总代理
   type: url-test  # 改回url-test确保自动选择最优节点
   url: http://www.gstatic.com/generate_204
   interval: 300
   proxies:
     - 香港
     - 台湾
     - 日本
     - 新加坡
     - 美国
     - 英国
     - 韩国
     - 德国
     - 其他
      
  - name: AI服务
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - 美国
      - 英国
      - 德国

rules:
  # 日本代理
  - DOMAIN-SUFFIX,seesaa.jp,日本
  - DOMAIN-SUFFIX,mgstage.com,日本
  
  # 非日代理
  - DOMAIN-SUFFIX,javdb.com,其他
  - DOMAIN-SUFFIX,airav.cc,其他
  - DOMAIN-SUFFIX,seajav.com,其他
  - DOMAIN-SUFFIX,lulubar.co,其他
  - DOMAIN-SUFFIX,gg5.co,其他

  # OpenAI
  - DOMAIN-SUFFIX,openai.com,AI服务
  - DOMAIN-SUFFIX,chatgpt.com,AI服务
  - DOMAIN-SUFFIX,openaicdn.com,AI服务
  - DOMAIN-SUFFIX,oaistatic.com,AI服务
  - DOMAIN-SUFFIX,oaiusercontent.com,AI服务
  - DOMAIN-SUFFIX,anthropic.com,AI服务
  - DOMAIN-SUFFIX,claude.ai,AI服务
  - DOMAIN-SUFFIX,gemini.google.com,AI服务
  - DOMAIN-SUFFIX,palm.googleapis.com,AI服务
  - DOMAIN-SUFFIX,copilot.microsoft.com,AI服务
  - DOMAIN-SUFFIX,bing.com,AI服务
  - DOMAIN-SUFFIX,midjourney.com,AI服务
  - DOMAIN-SUFFIX,stability.ai,AI服务
  - DOMAIN-SUFFIX,runwayml.com,AI服务
  - DOMAIN-SUFFIX,perplexity.ai,AI服务
  - DOMAIN-SUFFIX,poe.com,AI服务
  - DOMAIN-SUFFIX,coze.com,AI服务
  - DOMAIN-SUFFIX,deepai.org,AI服务
  - DOMAIN-SUFFIX,elevenlabs.io,AI服务
  - DOMAIN-SUFFIX,replicate.com,AI服务

  # 其他直连
  - DOMAIN-SUFFIX,bbs.binmt.cc,DIRECT
  - DOMAIN-SUFFIX,winverlemon.top,DIRECT
  - DOMAIN-SUFFIX,danchaofan.ym-club.pp.ua,DIRECT
  - DOMAIN-SUFFIX,h5.yezi66.net,DIRECT

  # PT站点直连
  - DOMAIN-SUFFIX,1ptba.com,DIRECT
  - DOMAIN-SUFFIX,ptcafe.club,DIRECT
  - DOMAIN-SUFFIX,btschool.club,DIRECT
  - DOMAIN-SUFFIX,haidan.video,DIRECT
  - DOMAIN-SUFFIX,hdarea.club,DIRECT
  - DOMAIN-SUFFIX,hdfans.org,DIRECT
  - DOMAIN-SUFFIX,hdtime.org,DIRECT
  - DOMAIN-SUFFIX,hdvideo.one,DIRECT
  - DOMAIN-SUFFIX,hhanclub.top,DIRECT
  - DOMAIN-SUFFIX,hhan.club,DIRECT
  - DOMAIN-SUFFIX,m-team.cc,DIRECT
  - DOMAIN-SUFFIX,pttime.org,DIRECT
  - DOMAIN-SUFFIX,rousi.zip,DIRECT

  # 下载工具直连
  - PROCESS-NAME,aria2c,DIRECT
  - PROCESS-NAME,fdm,DIRECT
  - PROCESS-NAME,Folx,DIRECT
  - PROCESS-NAME,NetTransport,DIRECT
  - PROCESS-NAME,Thunder,DIRECT
  - PROCESS-NAME,Transmission,DIRECT
  - PROCESS-NAME,uTorrent,DIRECT
  - PROCESS-NAME,WebTorrent,DIRECT
  - PROCESS-NAME,WebTorrent Helper,DIRECT
  - PROCESS-NAME,DownloadService,DIRECT
  - PROCESS-NAME,Weiyun,DIRECT
  
  # 下载域名直连
  - DOMAIN-KEYWORD,aria2,DIRECT
  - DOMAIN-KEYWORD,xunlei,DIRECT
  - DOMAIN-KEYWORD,yunpan,DIRECT
  - DOMAIN-KEYWORD,Thunder,DIRECT
  - DOMAIN-KEYWORD,XLLiveUD,DIRECT
  
  # 本地网络规则
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR6,::1/128,DIRECT,no-resolve
  
  # 基础规则
  - GEOIP,CN,DIRECT
  - MATCH,总代理